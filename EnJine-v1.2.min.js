var Keys={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,delete:46,number0:48,number1:49,number2:50,number3:51,number4:52,number5:53,number6:54,number7:55,number8:56,number9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindowKey:91,rightWindowKey:92,selectKey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semicolon:186,equal:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backslash:220,closeBraket:221,singleQuote:222};var degToRad=Math.PI/180,radToDeg=180/Math.PI;class vec{x;y;constructor(t=0,a=0){this.x=t,this.y=a}translate(t){return this.x+=t.x,this.y+=t.y,this}add(t){var{x:a,y:r}=t;return new vec(this.x+a,this.y+r)}translate(t){var{x:a,y:r}=t;this.x+=a,this.y+=r}dotProduct(t){var{x:a,y:r}=t;return this.x*a+this.y*r}fromPolar(t,a,r=1){this.x=Math.cos(degToRad*a)*r+t.x,this.y=Math.sin(degToRad*a)*r+t.y}normalize(){var t=this.length();return t=0==t?1:t,new vec(this.x/t,this.y/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}rotate(t){var a=this.x*Math.cos(t*degToRad)-this.y*Math.sin(t*degToRad),r=this.x*Math.sin(t*degToRad)+this.y*Math.cos(t*degToRad);return new vec(a,r)}rotateToward(t){var{x:a,y:r}=t;return this.rotate((-Math.atan(r/a)-(a>=this.x?0:Math.PI))*radToDeg)}invert(){return new vec(-this.x,-this.y)}multiply(t){return new vec(this.x*t,this.y*t)}lerp(t,a){var{x:r,y:s}=t;return new vec(this.x*(1-a)+r*a,this.y*(1-a)+s*a)}toString(){return`{x: ${Math.round(100*this.x)/100}; y: ${Math.round(100*this.y)/100}}`}}class Color{static black="#000";static blue="#00f";static green="#0f0";static cyan="#0ff";static red="#f00";static magenta="#f0f";static yellow="#ff0";static white="#fff";static orange="#FFA500";static aliceBlue="#f0f8ff";static wheat="#f5deb3";static tomato="#ff6347";static gray="#808080";static pink="#ee82ee";static lightGray="#d3d3d3";_color="";constructor(t,a,r,s){var e={r:t,g:a,b:r,a:s};null==s&&(e.a=1,null==r&&(e={r:null==t?0:t,g:null==t?0:t,b:null==t?0:t,a:null==a?1:a})),this._color=`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}}class Ray{origin=new vec;direction=new vec}function lerp(t,a,r){return t*(1-r)+a*r}function LoadContent(n){if(null!=n){for(const[e,o]of Object.entries(n)){var t=new Image;t.src=o,n[e]=t}Content=n}}class Animation{_parent=void 0;name="animation";enabled=!0;spriteSheet=void 0;spriteSize=new vec;animation=0;frame=0;frameCount=0;animationSpeed=0;mirror=new vec(1,1);constructor(t){this.SetAnimation(t)}timer=0;SetAnimation(t){if(null!=t){var{spriteSheet:i,spriteSize:e,animation:s,animationSpeed:o,frameCount:n,frame:a}=t;this.spriteSheet=i??this.spriteSheet,this.spriteSize=e??this.spriteSize,this.animation=s??this.animation,this.frameCount=n??this.frameCount,this.animationSpeed=o??this.animationSpeed,this.frame=a??this.frame}this.timer=0}Update(){this.frameCount>0&&this.animationSpeed>0&&this.enabled&&(this.frame>=this.frameCount-1?(this.timer=0,this.frame=0):(this.timer+=this.animationSpeed,this.frame=Math.floor(this.timer)))}Pause=t=>this.enabled=!1;Play=t=>this.enabled=!0;Toggle=t=>this.enabled=!this.enabled}class Physics{_parent=void 0;name="physics";enabled=!0;velocity=new vec;momentum=new vec;force=new vec;mass=1;immovable=!1;slippery=.5;constructor(t){if(null!=t){var{slippery:i,immovable:e,mass:s}=t;this.slippery=i??this.slippery,this.immovable=e??this.immovable,this.mass=s??this.mass}}Update(){this.velocity=this.velocity.lerp(new vec,this.slippery),this.momentum=this.momentum.lerp(this.velocity,this.slippery),this._parent.GetComponent("transform").position.translate(this.momentum)}ApplyForce(t){this.immovable||(this.velocity=t.multiply(1/this.mass))}}class Transform{_parent=void 0;name="transform";enabled=!0;position=new vec;rotation=0;scale=new vec;depth=0;pivot=new vec;constructor(t){if(null!=t){var{position:i,rotation:e,scale:s,depth:o,pivot:n}=t;this.position=i??this.position,this.rotation=e??this.rotation,this.scale=s??this.scale,this.depth=o??this.depth,this.pivot=n??this.pivot}}Update(){}}class Collider{_parent=void 0;name="collider";enabled=!0;offset=new vec;scale=new vec(32,32);position=new vec;color="#00000077";Left=0;Right=0;Top=0;Bottom=0;collisionOffset=10;_colisionState=!1;constructor(t){if(null!=t){var{offset:i,scale:e}=t;this.offset=i??this.offset,this.scale=e??this.scale}}Update(){this.Left=this.position.x,this.Right=this.position.x+this.scale.x,this.Top=this.position.y,this.Bottom=this.position.y+this.scale.y,this.position=this._parent.GetComponent("transform").position.add(this.offset)}IsOverlapping(t){if(!t.HasComponent("collider"))return!1;var{position:i,scale:e}=t.GetComponent("collider");return this.enabled&&i.x<this.position.x+this.scale.x&&i.x+e.x>this.position.x&&i.y<this.position.y+this.scale.y&&i.y+e.y>this.position.y}OnCollide(t,i){if(!t.HasComponent("collider"))return!1;var e=this.IsCollideLeft(t)||this.IsCollideTop(t)||this.IsCollideRight(t)||this.IsCollideBottom(t);return e&&!this._colisionState?(this._colisionState=!0,null!=i&&i(),this._colisionState):(e||(this._colisionState=!1),!1)}IsCollideLeft(t){if(!t.HasComponent("collider"))return!1;var i=this._parent.GetComponent("physics").velocity,e=t.GetComponent("collider");return this.enabled&&this.Right+i.x>e.Left&&this.Left<e.Left&&this.Bottom-this.collisionOffset>e.Top+this.collisionOffset&&this.Top+this.collisionOffset<e.Bottom-this.collisionOffset}IsCollideRight(t){if(!t.HasComponent("collider"))return!1;var i=t.GetComponent("collider"),e=this._parent.GetComponent("physics").velocity;return this.enabled&&this.Left+e.x<i.Right&&this.Right>i.Right&&this.Bottom-this.collisionOffset>i.Top+this.collisionOffset&&this.Top+this.collisionOffset<i.Bottom-this.collisionOffset}IsCollideTop(t){if(!t.HasComponent("collider"))return!1;var i=t.GetComponent("collider"),e=this._parent.GetComponent("physics").velocity;return this.enabled&&this.Bottom+e.y>i.Top&&this.Top<i.Top&&this.Left+this.collisionOffset<i.Right-this.collisionOffset&&this.Right-this.collisionOffset>i.Left+this.collisionOffset}IsCollideBottom(t){if(!t.HasComponent("collider"))return!1;var i=t.GetComponent("collider"),e=this._parent.GetComponent("physics").velocity;return this.enabled&&this.Top+e.y<i.Bottom&&this.Bottom>i.Bottom&&this.Left+this.collisionOffset<i.Right-this.collisionOffset&&this.Right-this.collisionOffset>i.Left+this.collisionOffset}}class Trigger extends Collider{_parent=void 0;name="trigger";constructor(t){super(t)}}class Shadow{_parent=void 0;name="shadow";enabled=!0;radius=100;color=new Color;constructor(t){if(null!=t){var{radius:i,color:e}=t;this.radius=i??this.radius,this.color=e??this.color}}Update=()=>{}}class GameObject{components={};constructor(){}AddComponent(t){t._parent=this,this.components[t.name]=t}GetComponent(t){return this.components[t]}HasComponent=t=>null!=this.components[t];Draw(){if(this.HasComponent("transform")&&this.HasComponent("animation")){var t=this.GetComponent("transform"),i=this.GetComponent("animation"),e=MainCamera.ScreenPosition(t.position);if(!(e.x+t.scale.x<0&&e.y+t.scale.y<0&&e.x>MainCamera.resolution.x&&e.y>MainCamera.resolution.y)&&null!=i.spriteSheet){if(this.HasComponent("shadow")){var s=this.GetComponent("shadow");context.fillStyle=s.color._color,context.beginPath(),context.ellipse(e.x+t.pivot.x,e.y+t.scale.y,s.radius,s.radius/2,0,0,2*Math.PI),context.fill()}if(context.save(),context.translate(e.x+t.pivot.x,e.y+t.pivot.y),context.rotate(t.rotation*degToRad),context.scale(i.mirror.x,i.mirror.y),context.translate(-e.x-t.pivot.x,-e.y-t.pivot.y),context.drawImage(i.spriteSheet,i.frame*i.spriteSize.x,i.animation*i.spriteSize.y,i.spriteSize.x,i.spriteSize.y,e.x,e.y,t.scale.x,t.scale.y),context.restore(),this.HasComponent("collider")){var o=this.GetComponent("collider");if(GameSettings.ShowColliders&&o.enabled){var n=MainCamera.ScreenPosition(o.position);context.fillStyle=o.color,context.fillRect(n.x,n.y,o.scale.x,o.scale.y)}}if(this.HasComponent("trigger")){var a=this.GetComponent("trigger");if(GameSettings.ShowColliders&&a.enabled){var l=MainCamera.ScreenPosition(a.position);context.fillStyle="#00f6",context.fillRect(l.x,l.y,a.scale.x,a.scale.y)}}}}}Update(){Object.values(this.components).forEach((t=>t.Update()))}}class Camera{position=new vec;resolution=new vec;aspect=1;UpdateAspectRatio(){this.aspect=this.resolution.x/this.resolution.y}ScreenPosition(t){return t.add(this.position.invert())}}class Sound{source="";_audio;constructor(t){if(_audio=new Audio,null!=t){var{source:i}=t;this.source=i??this.source}}Play(){}}class SoundEmitter{_sound=void 0;_emitState=!1;randomize=!1;delay=100;source=[""];volume=1;constructor(t){if(null!=t){var{source:i,delay:e,randomize:s,volume:o}=t;this.source=i??this.source,this.delay=e??this.delay,this.randomize=s??this.randomize,this.volume=o??this.volume}}Play(){if(!this._emitState){if(this._sound=new Audio,this.randomize){var t=Math.round(Math.random()*(this.source.length-1));this._sound.src=this.source[t]}else this._sound.src=this.source[0];this._sound.volume=this.volume,this._emitState=!0,this._sound.play(),setTimeout((t=>{this._emitState=!1}),this.delay)}}}class TileMap{visible=!0;position=new vec;size=new vec(256,256);source=void 0;tileSize=new vec(32,32);tileCount=new vec;map=[];constructor(){}Update(){}Draw(){if(null!=this.source){this.tileCount=new vec(this.source.width/this.tileSize.x,this.source.height/this.tileSize.y);for(var t=0;t<this.map.length;t++)for(var i=0;i<this.map[t].length;i++){var e=this.map[t][i],s=MainCamera.ScreenPosition(this.position.add(new vec(i*this.size.x,t*this.size.y)));context.drawImage(this.source,e%this.tileCount.x*this.tileSize.x,Math.floor(e/this.tileCount.y)*this.tileSize.y,this.tileSize.x,this.tileSize.y,s.x,s.y,this.size.x,this.size.y)}}}}var canvas,context;const resizeEvent=new Event("resize"),startEvent=new Event("start"),updateEvent=new Event("update"),drawEvent=new Event("draw");var MainCamera=new Camera;window.onresize=e=>{canvas.dispatchEvent(resizeEvent)},document.addEventListener("contextmenu",(e=>e.preventDefault())),document.body.addEventListener("keydown",(e=>{Input.Keyboard.keys[e.keyCode].keypress=!0,Input.Keyboard.keys[e.keyCode].keyup=!1})),document.body.addEventListener("keyup",(e=>{Input.Keyboard.keys[e.keyCode].keypress=!1,Input.Keyboard.keys[e.keyCode].keydown=!1}));var Events=[],GameSettings={EnableSmoothing:!1,canvas:"#canvas",ClearColor:"#8dcaff",ShowColliders:!1,Window:{width:1e3,height:1e3}},GameState={ContentLoaded:!1},Input={Keyboard:{keys:[],IsKeyDown:e=>null!=Input.Keyboard.keys[e]&&Input.Keyboard.keys[e].keypress,OnKeyDown(e){var t=Input.Keyboard.keys[e];return!(t.keydown||!t.keypress)&&(t.keydown=!0,!0)},OnKeyUp(e){var t=Input.Keyboard.keys[e];return!t.keyup&&!t.keypress&&(t.keyup=!0,!0)}},Mouse:{m0:!1,m1:!1,m2:!1,position:new vec}},Content={},Time={deltaTime:0,elapsed:0,lag:0,fps:0};function EventHandler(e,t){Events.push({event:e,func:t})}function UpdateResolution(){canvas.width=GameSettings.Window.width,canvas.height=GameSettings.Window.height,MainCamera.resolution=new vec(canvas.width,canvas.height),MainCamera.UpdateAspectRatio(),context.webkitImageSmoothingEnabled=GameSettings.EnableSmoothing,context.mozImageSmoothingEnabled=GameSettings.EnableSmoothing,context.imageSmoothingEnabled=GameSettings.EnableSmoothing}window.onload=()=>{canvas=document.querySelector(GameSettings.canvas),context=canvas.getContext("2d"),UpdateResolution(),Events.forEach((e=>{canvas.addEventListener(e.event,e.func)})),canvas.dispatchEvent(startEvent),Object.values(Keys).forEach((e=>{Input.Keyboard.keys[e]={keypress:!1,keydown:!1,keyup:!0}})),gameLoop()},document.body.addEventListener("mousemove",(e=>{Input.Mouse.position=new vec(e.clientX,e.clientY)}));let fps=60,start=Date.now(),frameDuration=1e3/fps,lag=0;function gameLoop(){requestAnimationFrame(gameLoop,canvas);var e=Date.now(),t=e-start;for(start=e,lag+=t;lag>=frameDuration;)lag-=frameDuration,canvas.dispatchEvent(updateEvent);context.fillStyle=GameSettings.ClearColor,context.fillRect(0,0,canvas.width,canvas.height),canvas.dispatchEvent(drawEvent),Time.deltaTime=lag/frameDuration,Time.lag=Math.floor(lag),Time.fps=Math.floor(1e3/t),Time.elapsed=t}